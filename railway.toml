[build]
builder = "nixpacks"

[build.phases.setup]
# Perintah ini memaksa instalasi .NET 8 SDK
cmds = ["curl -sSL https://dot.net/v1/dotnet-install.sh | bash /dev/stdin --channel 8.0 --install-dir /usr/share/dotnet"]

[build.phases.install]
# Pastikan menggunakan path dotnet yang baru diinstal
cmds = ["dotnet restore"]

[build.phases.build]
# Hapus --no-restore agar lebih aman jika ada package yang tertinggal
cmds = ["dotnet publish TokoApi.csproj -c Release -o out"]

[deploy]
start_cmd = "ASPNETCORE_URLS=http://0.0.0.0:${PORT:-3000} ./out/TokoApi"